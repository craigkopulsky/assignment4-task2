---
title: "assignment4_task2"
author: "Craig Kopulsky"
date: "11/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(lubridate)
library(kableExtra)
library(effsize)
library(ggbeeswarm)

```

# Hare sizes and weights in the Bonanza Creek: exploratory report

```{r}
hares_data <- read.csv(here("data", "bonanza_hares.csv")) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date)) %>% 
  mutate(sex_full = case_when(
    sex == "m" ~ "Male",
    sex == "f" ~ "Female",
    is.na(sex) ~ "NA")) %>%
  mutate(site = case_when(
    grid == "bonrip" ~ "Riperian",
    grid == "bonbs" ~ "Lowland",
    grid == "bonmat" ~ "Mature"
  ))
      
    
```



## 1. Introduction


## 2. Data analysis


## 3. Exploratory findings


### Annual juvenile hare trap counts
```{r}
annual_juv <- hares_data %>% 
  filter(age == "j")

ggplot(data = annual_juv, aes(year)) +
  geom_histogram() + 
  labs(x = "Year",
       y = "Total Juvenile Hares Trapped") +
  scale_x_continuous(breaks=seq(1999, 2012, 1)) +
  scale_y_continuous(breaks=seq(0,130, 10))

```









```{r}
annual_juv_counts <- annual_juv %>% 
  group_by(year) %>% 
  summarize(count = n())



annual_juv_counts

ggplot(data = annual_juv_counts, aes(x = year, y = count)) + 
  geom_col() +
  labs(x = "Year",
       y = "Total Juvenile Hares Trapped") + 
  scale_x_continuous(breaks=seq(1999, 2012, 1)) +
  scale_y_continuous(breaks=seq(0, 130, 10))



juv_counts_summary <- annual_juv_counts %>% 
  summarize(mean = mean(count), median = median(count))

juv_counts_summary
  
```

The average number of juvenile hares trapped yearly in Bonanza Creek is 31.5 hares and the median number trapped yearly is 18.5 hares. There were 126 total juvenile hare trappings in Bonanza Creek in 1999, the highest number for the duration of the study. After this initial peak, annual juvenile hare trappings in Bonanza Creek sharply declined, never reaching the mean after 2000, except for relatively large annual juvenile hare trappings of 48 and 44 hares in 2005 and 2008 respectively. Annual juvenile hare trappings were as low as 2 hares in 2010.



### Visualize juvenile hare weights
```{r}
ggplot(data = annual_juv, aes(weight)) +
  geom_histogram() +
  facet_wrap(~sex)

weight_sex_summary <- annual_juv %>% 
  group_by(sex) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), median = median(weight, na.rm = TRUE), sd = sd(weight, na.rm = TRUE), n = n())
kbl(weight_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")

ggplot(data = annual_juv, aes(weight)) +
  geom_histogram() +
  facet_wrap(~grid)

site_sex_summary <- annual_juv %>% 
  group_by(grid) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), median = median(weight, na.rm = TRUE), sd = sd(weight, na.rm = TRUE), n = n())
kbl(site_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")
```

```{r}
ggplot(data = annual_juv, aes(x=site, y=weight)) +
  geom_beeswarm(aes(color = site)) +
  facet_wrap(~sex_full) +
  geom_boxplot(alpha = 0.1) +
  facet_wrap(~sex_full) +
  stat_summary(fun = mean,
               geom = "point",
               shape = 20,
               size = 4,
               color = "black",
               fill = "black") + 
  labs(x = "Bonanza Creek Site",
       y = "Weight (g)")
  

```

**Figure 2.** Weight observations (g) for juvenile hares by sex found at each of the three trap sites in Bonanza Creek for the study. Red (Lowland Site), green (Mature Site), and blue (Riperian Site) points indicate individual observations for weight (g) of juvenile hares. Box endpoints indicate the 25th and 75th percentile values; the black line within the box indicates the median value and the black point indicates the mean value for each group shown. Data: Kielland et al. (2017)


**Table 2.** Descriptive statistics (mean, median, standard deviation, and sample size) for juvenile hares observed in Bonanza Creek, by sex and site where trapped. Data: Kielland et al. (2017)
```{r}
site_sex_summary <- annual_juv %>% # need to remove all counts. check n values against other, need to rename variables at top to work
  group_by(sex_full, site) %>% 
  rename(Sex = sex_full,
         Site = site) %>% 
  summarize("Mean weight (g)" = mean(weight, na.rm = TRUE),
            "Median weight (g)" = median(weight, na.rm = TRUE),
            "Standard deviation (g)" = sd(weight, na.rm = TRUE),
            "Sample size" = n())
kbl(site_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")

```

```{r}
f_lowland_mean <- site_sex_summary[1,3]

f_mature_mean <- site_sex_summary[2,3]

f_riperian_mean <- site_sex_summary[3,3]

m_lowland_mean <- site_sex_summary[4,3]

m_mature_mean <- site_sex_summary[5,3]

m_riperian_mean <- site_sex_summary[6,3]

f_lowland_sd <- site_sex_summary[1,5]

f_mature_sd <- site_sex_summary[2,5]

f_riperian_sd <- site_sex_summary[3,5]

m_lowland_sd <- site_sex_summary[4,5]

m_mature_sd <- site_sex_summary[5,5]

m_riperian_sd <- site_sex_summary[6,5]

f_lowland_n <- site_sex_summary[1,6]

f_mature_n <- site_sex_summary[2,6]

f_riperian_n <- site_sex_summary[3,6]

m_lowland_n <- site_sex_summary[4,6]

m_mature_n <- site_sex_summary[5,6]

m_riperian_n <- site_sex_summary[6,6]
```


Add in referencing

Juvenile hare weights (g) were compared across sex and site where they were trapped. Both the males trapped at the Lowland site (`r round(m_lowland_mean, digits = 2)` ± `r round(m_lowland_sd, digits = 2)` g, n = `r round(m_lowland_n)`; mean ± 1 standard deviation) and females trapped at the Lowland site (`r round(f_lowland_mean, digits = 2)` ± `r round(f_lowland_sd, digits = 2)` g, n = `r round(f_lowland_n)`) were heavier than their geneder counterparts at the other sites: males trapped at the Mature site (`r round(m_mature_mean, digits = 2)` ± `r round(m_mature_sd, digits = 2)` g, n = `r round(m_mature_n)`, males trapped at the Riperian site(`r round(m_riperian_mean, digits = 2)` ± `r round(m_riperian_sd, digits = 2)` g, n = `r round(m_riperian_n)`, females trapped at the Mature site(`r round(f_mature_mean, digits = 2)` ± `r round(f_mature_sd, digits = 2)` g, n = `r round(f_mature_n)`, and females trapped at the Riperian site(`r round(f_riperian_mean, digits = 2)` ± `r round(f_riperian_sd, digits = 2)` g, n = `r round(f_riperian_n)`. As expected, the males observed at each site were heavier than females observed at the same site, but the difference in means between male and female juvenile hares at the Lowland site is only `r round(m_lowland_mean - f_lowland_mean, digits = 2)`g, less than the difference betweeen males and females at the other sites.





### Juvenile weight comparison (male and female snowshoe hares)


```{r}
mf_annual_juv <- annual_juv %>%
  filter(sex == "m" | sex == "f")

final_weight_sex_summary <- mf_annual_juv %>% 
  group_by(sex_full) %>% 
  rename(Sex = sex_full) %>% 
  summarize("Mean Weight (g)" = mean(weight, na.rm = TRUE), "Median Weight (g)" = median(weight, na.rm = TRUE), "Standard Deviation (g)" = sd(weight, na.rm = TRUE), "Sample Size" = n())
final_weight_sex_summary
kbl(final_weight_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")

```

```{r}
male_weight <- mf_annual_juv %>% 
  filter(sex == "m") %>% 
  pull(weight)

female_weight <- mf_annual_juv %>% 
  filter(sex == "f") %>% 
  pull(weight)

t.test(x = male_weight, female_weight)

cohen.d(male_weight, female_weight, na.rm = TRUE)
  
```


### Relationship between juvenile weight and hind foot length

```{r}
hindft_weight_comp <- hares_data %>%  # need to finish
  filter(hindft != "NA" & weight != "NA")

ggplot(data = hindft_weight_comp, aes(x = hindft, y = weight)) +
  geom_point() +
  labs(x = "Hind Foot Length (measurement)",
       y = "Weight(g)")
```



