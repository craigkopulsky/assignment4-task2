---
title: "assignment4_task2"
author: "Craig Kopulsky"
date: "11/17/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(lubridate)
library(kableExtra)
library(effsize)
library(ggbeeswarm)

```


```{r}
hares_data <- read.csv(here("data", "bonanza_hares.csv")) %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date)) %>% 
  mutate(sex_full = case_when(
    sex == "m" ~ "Male",
    sex == "f" ~ "Female",
    is.na(sex) ~ "NA")) %>%
  mutate(site = case_when(
    grid == "bonrip" ~ "Riperian",
    grid == "bonbs" ~ "Lowland",
    grid == "bonmat" ~ "Mature"
  ))
      
    
```



# 1. Introduction


# 2. Data an analysis


# 3. Exploratory findings


### Annual juvenile hare trap counts
```{r}
annual_juv <- hares_data %>% 
  filter(age == "j")

ggplot(data = annual_juv, aes(year)) +
  geom_histogram() + 
  labs(x = "Year",
       y = "Total Juvenile Hares Trapped") +
  scale_x_continuous(breaks=seq(1999, 2012, 1))

annual_juv_counts <- annual_juv %>% 
  group_by(year) %>% 
  summarize(count = n())

annual_juv_counts

ggplot(data = annual_juv_counts, aes(x = year, y = count)) +
  geom_line() +
  labs(x = "Year",
       y = "Total Juvenile Hares Trapped") + 
  scale_x_continuous(breaks=seq(1999, 2012, 1))

juv_counts_summary <- annual_juv_counts %>% 
  summarize(mean = mean(count), median = median(count))

juv_counts_summary
  
```

The average number of juvenile hares trapped yearly in Bonanza Creek is 31.5 hares and the median number trapped yearly is 18.5 hares. There were 126 total juvenile hare trappings in Bonanza Creek in 1999, the highest number for the duration of the study. After this initial peak, annual juvenile hare trappings in Bonanza Creek sharply declined, never reaching the mean after 2000, except for relatively large annual juvenile hare trappings of 48 and 44 hares in 2005 and 2008 respectively. Annual juvenile hare trappings were as low as 2 hares in 2010.



### Visualize juvenile hare weights
```{r}
ggplot(data = annual_juv, aes(weight)) +
  geom_histogram() +
  facet_wrap(~sex)

weight_sex_summary <- annual_juv %>% 
  group_by(sex) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), median = median(weight, na.rm = TRUE), sd = sd(weight, na.rm = TRUE), n = n())
kbl(weight_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")

ggplot(data = annual_juv, aes(weight)) +
  geom_histogram() +
  facet_wrap(~grid)

site_sex_summary <- annual_juv %>% 
  group_by(grid) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), median = median(weight, na.rm = TRUE), sd = sd(weight, na.rm = TRUE), n = n())
kbl(site_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")
```

```{r}
ggplot(data = annual_juv, aes(x=site, y=weight)) +
  geom_beeswarm(aes(color = site)) +
  facet_wrap(~sex_full) +
  geom_boxplot(alpha = 0.1) +
  facet_wrap(~sex_full) +
  labs(x = "Bonanza Creek Site", y = "Weight (g)")
  

```

```{r}

annual_juv_sitesex_cats <- annual_juv %>% 
  mutate(sitesex_cat = case_when(
    sex_full == "Female" & site == "Lowland" ~ "f - Lowland",
    sex_full == "Female" & site == "Mature" ~ "f - Mature",
    sex_full == "Female" & site == "Riperian" ~ "f - Riperian",
    sex_full == "Male" & site == "Lowland" ~ "m - Lowland",
    sex_full == "Male" & site == "Mature" ~ "m - Mature",
    sex_full == "Male" & site == "Riperian" ~ "m - Riperian",
    sex_full == "NA" & site == "Lowland" ~ "NA - Lowland",
    sex_full == "NA" & site == "Mature" ~ "NA - Mature",
    sex_full == "NA" & site == "Riperian" ~ "NA - Riperian"
  ))

sitesex_cat_stats <- annual_juv_sitesex_cats %>% 
  group_by(sitesex_cat) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), sd = sd(weight, na.rm = TRUE))
sitesex_cat_stats

annual_juv_sitesex_cat_stats <- annual_juv_sitesex_cats %>% 
  mutate(sitesex_mean = case_when(
    sitesex_cat == "f - Lowland" ~ 1022.0588,
    sitesex_cat == "f - Mature" ~ 808.1944,
    sitesex_cat == "f - Riperian" ~ 824.1496,
    sitesex_cat == "m - Lowland" ~ 1073.0769,
    sitesex_cat == "m - Mature" ~ 950.1250,
    sitesex_cat == "m - Riperian" ~ 929.2727,
    sitesex_cat == "NA - Lowland" ~ NA_real_,
    sitesex_cat == "NA - Mature" ~ 816.6667,
    sitesex_cat == "NA - Riperian" ~ 372.0000,
  )) %>% 
  mutate(sitesex_sd = case_when(
    sitesex_cat == "f - Lowland" ~ 292.9632,
    sitesex_cat == "f - Mature" ~ 361.1235,
    sitesex_cat == "f - Riperian" ~ 255.0350,
    sitesex_cat == "m - Lowland" ~ 222.6408,
    sitesex_cat == "m - Mature" ~ 314.6864,
    sitesex_cat == "m - Riperian" ~ 349.1660,
    sitesex_cat == "NA - Lowland" ~ NA_real_,
    sitesex_cat == "NA - Mature" ~ 307.0939,
    sitesex_cat == "NA - Riperian" ~ 258.7856,
  ))


ggplot(data = annual_juv_sitesex_cat_stats) +
  geom_beeswarm(aes(x = site, y = weight, color = site)) +
  facet_wrap(~sex_full) +
  geom_point(aes(x = site, y = sitesex_mean),
             size = 1) +
  facet_wrap(~sex_full) +
  geom_errorbar(aes(x = site,
                    ymax = sitesex_mean + sitesex_sd,
                    ymin = sitesex_mean - sitesex_sd),
                width = 0.1) +
  labs(x = "Bonanza Creek Site", y = "Weight (g)")
  

```












2-3 sentences analysis


### Juvenile weight comparison (male and female snowshoe hares)


```{r}
mf_annual_juv <- annual_juv %>%
  filter(sex == "m" | sex == "f")

final_weight_sex_summary <- mf_annual_juv %>% 
  group_by(sex) %>% 
  summarize(mean = mean(weight, na.rm = TRUE), median = median(weight, na.rm = TRUE), sd = sd(weight, na.rm = TRUE), n = n())
final_weight_sex_summary
kbl(final_weight_sex_summary) %>% 
  kable_styling(full_width = FALSE, "hover")

male_weight <- mf_annual_juv %>% 
  filter(sex == "m") %>% 
  pull(weight)

female_weight <- mf_annual_juv %>% 
  filter(sex == "f") %>% 
  pull(weight)

t.test(x = male_weight, female_weight)

cohen.d(male_weight, female_weight)
  
```


### Relationship between juvenile weight and hind foot length

```{r}
hindft_weight_comp <- hares_data %>% 
  filter(hindft != "NA" & weight != "NA")

ggplot(data = hindft_weight_comp, aes(x = "hindft", y = "weight")) +
  geom_point()
```



